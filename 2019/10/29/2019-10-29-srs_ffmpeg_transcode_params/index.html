<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/head/dragon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/head/dragon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Microsoft YaHei, consolas:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="测试了一下ffmpeg中该如何去配置一些所需的转码配置。">
<meta property="og:type" content="article">
<meta property="og:title" content="srs中ffmpeg配置转码参数的一些介绍">
<meta property="og:url" content="http://example.com/2019/10/29/2019-10-29-srs_ffmpeg_transcode_params/index.html">
<meta property="og:site_name" content="龙">
<meta property="og:description" content="测试了一下ffmpeg中该如何去配置一些所需的转码配置。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/media/FFmpeg/bitrate-1.png">
<meta property="og:image" content="http://example.com/images/media/FFmpeg/bitrate-2.png">
<meta property="article:published_time" content="2019-10-29T07:11:00.000Z">
<meta property="article:modified_time" content="2019-10-29T08:06:08.069Z">
<meta property="article:author" content="龙">
<meta property="article:tag" content="live">
<meta property="article:tag" content="srs">
<meta property="article:tag" content="ffmpeg">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/media/FFmpeg/bitrate-1.png">

<link rel="canonical" href="http://example.com/2019/10/29/2019-10-29-srs_ffmpeg_transcode_params/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>srs中ffmpeg配置转码参数的一些介绍 | 龙</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">龙</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">哇咔咔</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/10/29/2019-10-29-srs_ffmpeg_transcode_params/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/head/head_bigfan.png">
      <meta itemprop="name" content="龙">
      <meta itemprop="description" content="哇咔咔">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="龙">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          srs中ffmpeg配置转码参数的一些介绍
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-10-29 15:11:00 / 修改时间：16:06:08" itemprop="dateCreated datePublished" datetime="2019-10-29T15:11:00+08:00">2019-10-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/live/" itemprop="url" rel="index"><span itemprop="name">live</span></a>
                </span>
            </span>

          
            <div class="post-description">测试了一下ffmpeg中该如何去配置一些所需的转码配置。</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <hr>
<h1 id="srs-所有转码参数介绍"><a href="#srs-所有转码参数介绍" class="headerlink" title="srs 所有转码参数介绍"></a>srs 所有转码参数介绍</h1><p>srs版本v2</p>
<p>参考来自<a target="_blank" rel="noopener" href="https://github.com/ossrs/srs/wiki/v2_CN_FFMPEG">srs官方FFMPEG教程</a></p>
<p>首先是原官方文档：</p>
<h2 id=""><a href="#" class="headerlink" title=""></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">listen              1935;</span><br><span class="line">vhost __defaultVhost__ &#123;</span><br><span class="line">    # the streaming transcode configs.</span><br><span class="line">    transcode &#123;</span><br><span class="line">        # whether the transcode enabled.</span><br><span class="line">        # if off, donot transcode.</span><br><span class="line">        # default: off.</span><br><span class="line">        enabled     on;</span><br><span class="line">        # the ffmpeg </span><br><span class="line">        ffmpeg      .&#x2F;objs&#x2F;ffmpeg&#x2F;bin&#x2F;ffmpeg;</span><br><span class="line">        # the transcode engine for matched stream.</span><br><span class="line">        # all matched stream will transcoded to the following stream.</span><br><span class="line">        # the transcode set name(ie. hd) is optional and not used.</span><br><span class="line">        engine example &#123;</span><br><span class="line">            # whether the engine is enabled</span><br><span class="line">            # default: off.</span><br><span class="line">            enabled         on;</span><br><span class="line">            # input format, can be:</span><br><span class="line">            # off, do not specifies the format, ffmpeg will guess it.</span><br><span class="line">            # flv, for flv or RTMP stream.</span><br><span class="line">            # other format, for example, mp4&#x2F;aac whatever.</span><br><span class="line">            # default: flv</span><br><span class="line">            iformat         flv;</span><br><span class="line">            # ffmpeg filters, follows the main input.</span><br><span class="line">            vfilter &#123;</span><br><span class="line">                # the logo input file.</span><br><span class="line">                i               .&#x2F;doc&#x2F;ffmpeg-logo.png;</span><br><span class="line">                # the ffmpeg complex filter.</span><br><span class="line">                # for filters, @see: http:&#x2F;&#x2F;ffmpeg.org&#x2F;ffmpeg-filters.html</span><br><span class="line">                filter_complex  &#39;overlay&#x3D;10:10&#39;;</span><br><span class="line">            &#125;</span><br><span class="line">            # video encoder name. can be:</span><br><span class="line">            #       libx264: use h.264(libx264) video encoder.</span><br><span class="line">            #       copy: donot encoder the video stream, copy it.</span><br><span class="line">            #       vn: disable video output.</span><br><span class="line">            vcodec          libx264;</span><br><span class="line">            # video bitrate, in kbps</span><br><span class="line">            # @remark 0 to use source video bitrate.</span><br><span class="line">            # default: 0</span><br><span class="line">            vbitrate        1500;</span><br><span class="line">            # video framerate.</span><br><span class="line">            # @remark 0 to use source video fps.</span><br><span class="line">            # default: 0</span><br><span class="line">            vfps            25;</span><br><span class="line">            # video width, must be even numbers.</span><br><span class="line">            # @remark 0 to use source video width.</span><br><span class="line">            # default: 0</span><br><span class="line">            vwidth          768;</span><br><span class="line">            # video height, must be even numbers.</span><br><span class="line">            # @remark 0 to use source video height.</span><br><span class="line">            # default: 0</span><br><span class="line">            vheight         320;</span><br><span class="line">            # the max threads for ffmpeg to used.</span><br><span class="line">            # default: 1</span><br><span class="line">            vthreads        12;</span><br><span class="line">            # x264 profile, @see x264 -help, can be:</span><br><span class="line">            # high,main,baseline</span><br><span class="line">            vprofile        main;</span><br><span class="line">            # x264 preset, @see x264 -help, can be: </span><br><span class="line">            #       ultrafast,superfast,veryfast,faster,fast</span><br><span class="line">            #       medium,slow,slower,veryslow,placebo</span><br><span class="line">            vpreset         medium;</span><br><span class="line">            # other x264 or ffmpeg video params</span><br><span class="line">            vparams &#123;</span><br><span class="line">                # ffmpeg options, @see: http:&#x2F;&#x2F;ffmpeg.org&#x2F;ffmpeg.html</span><br><span class="line">                t               100;</span><br><span class="line">                # 264 params, @see: http:&#x2F;&#x2F;ffmpeg.org&#x2F;ffmpeg-codecs.html#libx264</span><br><span class="line">                coder           1;</span><br><span class="line">                b_strategy      2;</span><br><span class="line">                bf              3;</span><br><span class="line">                refs            10;</span><br><span class="line">            &#125;</span><br><span class="line">            # audio encoder name. can be:</span><br><span class="line">            #       libfdk_aac: use aac(libfdk_aac) audio encoder.</span><br><span class="line">            #       copy: donot encoder the audio stream, copy it.</span><br><span class="line">            #       an: disable audio output.</span><br><span class="line">            acodec          libfdk_aac;</span><br><span class="line">            # audio bitrate, in kbps. [16, 72] for libfdk_aac.</span><br><span class="line">            # @remark 0 to use source audio bitrate.</span><br><span class="line">            # default: 0</span><br><span class="line">            abitrate        70;</span><br><span class="line">            # audio sample rate. for flv&#x2F;rtmp, it must be:</span><br><span class="line">            #       44100,22050,11025,5512</span><br><span class="line">            # @remark 0 to use source audio sample rate.</span><br><span class="line">            # default: 0</span><br><span class="line">            asample_rate    44100;</span><br><span class="line">            # audio channel, 1 for mono, 2 for stereo.</span><br><span class="line">            # @remark 0 to use source audio channels.</span><br><span class="line">            # default: 0</span><br><span class="line">            achannels       2;</span><br><span class="line">            # other ffmpeg audio params</span><br><span class="line">            aparams &#123;</span><br><span class="line">                # audio params, @see: http:&#x2F;&#x2F;ffmpeg.org&#x2F;ffmpeg-codecs.html#Audio-Encoders</span><br><span class="line">                # @remark SRS supported aac profile for HLS is: aac_low, aac_he, aac_he_v2</span><br><span class="line">                profile:a   aac_low;</span><br><span class="line">                bsf:a       aac_adtstoasc;</span><br><span class="line">            &#125;</span><br><span class="line">            # output format, can be:</span><br><span class="line">            #       off, do not specifies the format, ffmpeg will guess it.</span><br><span class="line">            #       flv, for flv or RTMP stream.</span><br><span class="line">            #       other format, for example, mp4&#x2F;aac whatever.</span><br><span class="line">            # default: flv</span><br><span class="line">            oformat         flv;</span><br><span class="line">            # output stream. variables:</span><br><span class="line">            #       [vhost] the input stream vhost.</span><br><span class="line">            #       [port] the intput stream port.</span><br><span class="line">            #       [app] the input stream app.</span><br><span class="line">            #       [stream] the input stream name.</span><br><span class="line">            #       [engine] the tanscode engine name.</span><br><span class="line">            output          rtmp:&#x2F;&#x2F;127.0.0.1:[port]&#x2F;[app]?vhost&#x3D;[vhost]&#x2F;[stream]_[engine];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></h2><h1 id="转码engine配置"><a href="#转码engine配置" class="headerlink" title="转码engine配置"></a>转码engine配置</h1><p>一个 transcode 中可以配置多个 engine 来进行转码：</p>
<h2 id="-1"><a href="#-1" class="headerlink" title=""></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vhost www.test.com &#123;</span><br><span class="line">    transcode &#123;</span><br><span class="line">        engine 360p &#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">        engine 480p &#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">        engine 720p &#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></h2><h1 id="srs-中可使用的转码参数"><a href="#srs-中可使用的转码参数" class="headerlink" title="srs 中可使用的转码参数"></a>srs 中可使用的转码参数</h1><hr>
<h2 id="整体参数"><a href="#整体参数" class="headerlink" title="整体参数"></a>整体参数</h2><h2 id="-2"><a href="#-2" class="headerlink" title=""></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"># 输入格式，其中flv表示输入格式为flv或者是RTMP。</span><br><span class="line">iformat         flv;</span><br><span class="line"></span><br><span class="line"># ffmpeg 滤镜</span><br><span class="line">vfilter &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 视频相关参数</span><br><span class="line">vcodec          libx264;</span><br><span class="line">vbitrate        1500;</span><br><span class="line">vfps            25;</span><br><span class="line">vwidth          768;</span><br><span class="line">vheight         320;</span><br><span class="line">vthreads        12;</span><br><span class="line">vprofile        main;</span><br><span class="line">vpreset         medium;</span><br><span class="line">vparams &#123;</span><br><span class="line">    t               100;</span><br><span class="line">    coder           1;</span><br><span class="line">    b_strategy      2;</span><br><span class="line">    bf              3;</span><br><span class="line">    refs            10;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 音频相关参数</span><br><span class="line">acodec          libfdk_aac;</span><br><span class="line">abitrate        70;</span><br><span class="line">asample_rate    44100;</span><br><span class="line">achannels       2;</span><br><span class="line">aparams &#123;</span><br><span class="line">    profile:a   aac_low;</span><br><span class="line">    bsf:a       aac_adtstoasc;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 输出格式，其中flv表示输出格式为flv或者是RTMP。</span><br><span class="line">oformat         flv;</span><br><span class="line"></span><br><span class="line"># 转码后的输出流</span><br><span class="line">output          rtmp:&#x2F;&#x2F;127.0.0.1:[port]&#x2F;[app]?vhost&#x3D;[vhost]&#x2F;[stream]_[engine];</span><br></pre></td></tr></table></figure></h2><h2 id="视频相关参数"><a href="#视频相关参数" class="headerlink" title="视频相关参数"></a>视频相关参数</h2><p><strong>vcodec：</strong></p>
<p>视频编码器名称，通常使用 libx264。</p>
<p><strong>vbitrate：</strong></p>
<p>视频编码所使用的码率，单位kbps。这里所设置的应该是视频的平均码率。</p>
<p><strong>vfps：</strong></p>
<p>视频帧率。</p>
<p><strong>vwidth：</strong></p>
<p>视频宽度。</p>
<p><strong>vheight：</strong></p>
<p>视频高度。</p>
<p><strong>vthreads：</strong></p>
<p>使用多少个线程来进行转码。开启多个线程需要codec（编解码器）支持才行。</p>
<p><strong>vprofile：</strong></p>
<p>可以简单理解为H264的版本，可以选择high,main,baseline。
暂时知道：压缩率 high &gt; main &gt; baseline。
暂时不知道它与画质有没有直接关系。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/matrix_laboratory/article/details/72764621">H264 Profile对比分析</a></p>
<p><strong>vpreset：</strong></p>
<p>用于调节编码速度和质量的平衡。
可以设置为：ultrafast,superfast,veryfast,faster,fast,medium,slow,slower,veryslow,placebo</p>
<p><strong>vparams：</strong></p>
<p>可以添加一些x264或者视频相关的参数。</p>
<ul>
<li>t：限制从输入文件读取的时长</li>
<li>coder：x264使用，熵编码相关参数。</li>
<li>b_strategy：x264使用，自适应的添加B帧数目，<code>Use only on first-pass</code>。</li>
<li>bf：<code>max number of B frames</code>。</li>
<li>refs：<code>Set reference frames to consider for motion compensation</code>。</li>
</ul>
<p><strong>实际上可以在这个参数中添加各种参数，而这些参数都会被添加在-preset后面。</strong></p>
<hr>
<h2 id="视频滤镜-vfilter"><a href="#视频滤镜-vfilter" class="headerlink" title="视频滤镜 vfilter"></a>视频滤镜 vfilter</h2><p><strong>i：</strong></p>
<p>表示输入，例如加水印时，就需要额外的图片作为输入。</p>
<p>可以有多个输入，并且输入也可以是流的形式，意思是可以支持多路流合并成为一路流。</p>
<p><strong>filter_complex：</strong></p>
<p>也就是FFmpeg的filter_complex，一个<code>filtergraph</code>，支持多个输入流。</p>
<p>使用它可以做各种事情，后面使用举例说明。</p>
<p>详细使用方法可以参考官方文档:<a target="_blank" rel="noopener" href="http://ffmpeg.org/ffmpeg-filters.html#Filtergraph-syntax-1">4.1 Filtergraph syntax</a></p>
<hr>
<h2 id="音频相关参数"><a href="#音频相关参数" class="headerlink" title="音频相关参数"></a>音频相关参数</h2><p><strong>acodec：</strong></p>
<p>音频编码器，通常使用 libfdk_aac 。</p>
<p><strong>abitrate：</strong></p>
<p>音频码率，单位kbps，<code>[16, 72] for libfdk_aac</code>。</p>
<p><strong>asample_rate：</strong></p>
<p>音频采样率，对于 flv和rtmp，只能设置为 44100,22050,11025,5512。</p>
<p><strong>achannels：</strong></p>
<p>声道，1表示单声道，2表示双声道。</p>
<p><strong>aparams：</strong></p>
<p>可以在里面填一些与音频相关的转码参数，同样的，这些参数会接在<code>achannels</code>(<code>-ac</code>)的后面。</p>
<ul>
<li>profile:a 与h264编码中的profile类似，这里支持 aac_low, aac_he, aac_he_v2 这几种参数的设置。</li>
<li>bsf:a 表示<code>Bitstream Filters</code>，详细参考<a target="_blank" rel="noopener" href="http://ffmpeg.org/ffmpeg-all.html#Bitstream-Filters">18 Bitstream Filters</a>。</li>
</ul>
<hr>
<h1 id="转码配置举例"><a href="#转码配置举例" class="headerlink" title="转码配置举例"></a>转码配置举例</h1><hr>
<h2 id="改变视频分辨率"><a href="#改变视频分辨率" class="headerlink" title="改变视频分辨率"></a>改变视频分辨率</h2><p><strong>方法一：</strong></p>
<p>使用<code>vwidth</code>和<code>vheight</code>参数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">vhost www.transcode.com &#123;</span><br><span class="line">    transcode &#123;</span><br><span class="line">        enabled      on;</span><br><span class="line">        ffmpeg      .&#x2F;objs&#x2F;ffmpeg&#x2F;bin&#x2F;ffmpeg;</span><br><span class="line">        engine 1080_60  &#123;</span><br><span class="line">            enabled         on;</span><br><span class="line">            vfilter &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            vcodec          libx264;</span><br><span class="line">            vbitrate        5000;</span><br><span class="line">            vfps            60;</span><br><span class="line">            vwidth          1920;</span><br><span class="line">            vheight         1080;</span><br><span class="line">            vthreads        12;</span><br><span class="line">            vprofile        main;</span><br><span class="line">            vpreset         fast;</span><br><span class="line">            vparams &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            acodec          libfdk_aac;</span><br><span class="line">            abitrate        50;</span><br><span class="line">            asample_rate    44100;</span><br><span class="line">            achannels       2;</span><br><span class="line">            aparams &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            output          rtmp:&#x2F;&#x2F;192.168.90.229:2019&#x2F;persist?vhost&#x3D;lrm.test.com&#x2F;long_1080_60;</span><br><span class="line">        &#125;</span><br><span class="line">        engine 720_60  &#123;</span><br><span class="line">            enabled         on;</span><br><span class="line">            vfilter &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            vcodec          libx264;</span><br><span class="line">            vbitrate        3500;</span><br><span class="line">            vfps            60;</span><br><span class="line">            vwidth          1280;</span><br><span class="line">            vheight         720;</span><br><span class="line">            vthreads        12;</span><br><span class="line">            vprofile        main;</span><br><span class="line">            vpreset         fast;</span><br><span class="line">            vparams &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            acodec          libfdk_aac;</span><br><span class="line">            abitrate        50;</span><br><span class="line">            asample_rate    44100;</span><br><span class="line">            achannels       2;</span><br><span class="line">            aparams &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            output          rtmp:&#x2F;&#x2F;192.168.90.229:2019&#x2F;persist?vhost&#x3D;lrm.test.com&#x2F;long_720_60;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面转码将视频转码成<code>1080P+60fps</code>和<code>720P+60fps</code>。</p>
<p><strong>方法二：</strong></p>
<p>使用<code>filter_complex</code>，在其中使用scale滤镜来缩减分辨率，并将<code>vwidth</code>和<code>vheight</code>设置为0。</p>
<h2 id="-3"><a href="#-3" class="headerlink" title=""></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">vhost www.transcode.com &#123;</span><br><span class="line">    transcode &#123;</span><br><span class="line">        enabled      on;</span><br><span class="line">        ffmpeg      .&#x2F;objs&#x2F;ffmpeg&#x2F;bin&#x2F;ffmpeg;</span><br><span class="line">        engine 720_60  &#123;</span><br><span class="line">            enabled         on;</span><br><span class="line">            vfilter &#123;</span><br><span class="line">                filter_complex  &#39;scale&#x3D;1280:-1&#39;;</span><br><span class="line">            &#125;</span><br><span class="line">            vcodec          libx264;</span><br><span class="line">            vbitrate        3500;</span><br><span class="line">            vfps            60;</span><br><span class="line">            vwidth          0;</span><br><span class="line">            vheight         0;</span><br><span class="line">            vthreads        12;</span><br><span class="line">            vprofile        main;</span><br><span class="line">            vpreset         fast;</span><br><span class="line">            vparams &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            acodec          libfdk_aac;</span><br><span class="line">            abitrate        50;</span><br><span class="line">            asample_rate    44100;</span><br><span class="line">            achannels       2;</span><br><span class="line">            aparams &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            output          rtmp:&#x2F;&#x2F;192.168.90.229:2019&#x2F;persist?vhost&#x3D;lrm.test.com&#x2F;long_720_60;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></h2><p><strong>结论：推荐使用方法二。</strong></p>
<p>如果输入视频不是16:9分辨率时，使用方法一转码视频造成画面拉伸，因为它的<code>vwidth</code>和<code>vheight</code>参数反映到FFmpeg中是<code>-s vwidth x vheight</code>，
使用-1时则会报错。而使用方法二则可以使用-1来维持原画面比例。</p>
<hr>
<h2 id="添加水印"><a href="#添加水印" class="headerlink" title="添加水印"></a>添加水印</h2><p>官方例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">vhost __defaultVhost__ &#123;</span><br><span class="line">    transcode &#123;</span><br><span class="line">        enabled     on;</span><br><span class="line">        ffmpeg      .&#x2F;objs&#x2F;ffmpeg&#x2F;bin&#x2F;ffmpeg;</span><br><span class="line">        engine ff &#123;</span><br><span class="line">            enabled         on;</span><br><span class="line">            vfilter &#123;</span><br><span class="line">                i               .&#x2F;doc&#x2F;ffmpeg-logo.png;</span><br><span class="line">                filter_complex      &#39;overlay&#x3D;10:10&#39;;</span><br><span class="line">            &#125;</span><br><span class="line">            vcodec          libx264;</span><br><span class="line">            vbitrate        300;</span><br><span class="line">            vfps            20;</span><br><span class="line">            vwidth          768;</span><br><span class="line">            vheight         320;</span><br><span class="line">            vthreads        2;</span><br><span class="line">            vprofile        baseline;</span><br><span class="line">            vpreset         superfast;</span><br><span class="line">            vparams &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            acodec          libfdk_aac;</span><br><span class="line">            abitrate        45;</span><br><span class="line">            asample_rate    44100;</span><br><span class="line">            achannels       2;</span><br><span class="line">            aparams &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            output          rtmp:&#x2F;&#x2F;127.0.0.1:[port]&#x2F;[app]?vhost&#x3D;[vhost]&#x2F;[stream]_[engine];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现方法，使用<code>vfilter</code>，输入图片并使用滤镜<code>overlay</code>来完成。</p>
<hr>
<h2 id="CBR恒定编码实现"><a href="#CBR恒定编码实现" class="headerlink" title="CBR恒定编码实现"></a>CBR恒定编码实现</h2><p>先来看一下使用<code>bitrate</code>来控制码率的情况：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">vhost lrm.test.com &#123;</span><br><span class="line">    transcode &#123;</span><br><span class="line">        enabled      on;</span><br><span class="line">        ffmpeg      .&#x2F;objs&#x2F;ffmpeg&#x2F;bin&#x2F;ffmpeg;</span><br><span class="line">        engine ff &#123;</span><br><span class="line">            enabled         on;</span><br><span class="line">            vfilter &#123;</span><br><span class="line">                i               .&#x2F;doc&#x2F;ffmpeg-logo.png;</span><br><span class="line">                filter_complex  &#39;[1][0]scale2ref&#x3D;w&#x3D;iw&#x2F;8:h&#x3D;ow&#x2F;mdar[scaled][0-out]; [0-out][scaled]overlay&#x3D;x&#x3D;main_w&#x2F;10-w&#x2F;2:y&#x3D;main_h&#x2F;10-h&#x2F;2[over]; [over]scale&#x3D;1280:-1&#39;;</span><br><span class="line">            &#125;</span><br><span class="line">            vcodec          libx264;</span><br><span class="line">            vbitrate        3500;</span><br><span class="line">            vfps            60;</span><br><span class="line">            vwidth          0;</span><br><span class="line">            vheight         0;</span><br><span class="line">            vthreads        12;</span><br><span class="line">            vprofile        main;</span><br><span class="line">            vpreset         fast;</span><br><span class="line">            vparams &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            acodec          libfdk_aac;</span><br><span class="line">            abitrate        50;</span><br><span class="line">            asample_rate    44100;</span><br><span class="line">            achannels       2;</span><br><span class="line">            aparams &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            output          rtmp:&#x2F;&#x2F;127.0.0.1:[port]&#x2F;[app]?vhost&#x3D;[vhost]&#x2F;[stream]_[engine];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里将<code>vbitrate</code>设置在3500，也就是我们希望码率可以控制在3500kbps，使用VLC播放器可以看到大概的统计效果：</p>
<p><img src="/images/media/FFmpeg/bitrate-1.png" alt="image" title="使用bitrate控制码率"></p>
<p>参数中虽然可以使用<code>bitrate</code>来指定码率，但是实际上这只是平均码率，但是实际码率还是会<strong>上下波动，并且范围也不小</strong>。</p>
<p>可以使用下面方法来实现<strong>CBR</strong>，也是FFmpeg文档中所述的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">vhost lrm.test.com &#123;</span><br><span class="line">    transcode &#123;</span><br><span class="line">        enabled      on;</span><br><span class="line">        ffmpeg      .&#x2F;objs&#x2F;ffmpeg&#x2F;bin&#x2F;ffmpeg;</span><br><span class="line">        engine ff &#123;</span><br><span class="line">            enabled         on;</span><br><span class="line">            vfilter &#123;</span><br><span class="line">                i               .&#x2F;doc&#x2F;ffmpeg-logo.png;</span><br><span class="line">                filter_complex  &#39;[1][0]scale2ref&#x3D;w&#x3D;iw&#x2F;8:h&#x3D;ow&#x2F;mdar[scaled][0-out]; [0-out][scaled]overlay&#x3D;x&#x3D;main_w&#x2F;10-w&#x2F;2:y&#x3D;main_h&#x2F;10-h&#x2F;2[over]; [over]scale&#x3D;1280:-1&#39;;</span><br><span class="line">            &#125;</span><br><span class="line">            vcodec          libx264;</span><br><span class="line">            vbitrate        3500;</span><br><span class="line">            vfps            60;</span><br><span class="line">            vwidth          0;</span><br><span class="line">            vheight         0;</span><br><span class="line">            vthreads        12;</span><br><span class="line">            vprofile        main;</span><br><span class="line">            vpreset         fast;</span><br><span class="line">            vparams &#123;</span><br><span class="line">                maxrate:v     3500k;</span><br><span class="line">                minrate:v     3500k;</span><br><span class="line">                bufsize:v     3500k;</span><br><span class="line">            &#125;</span><br><span class="line">            acodec          libfdk_aac;</span><br><span class="line">            abitrate        50;</span><br><span class="line">            asample_rate    44100;</span><br><span class="line">            achannels       2;</span><br><span class="line">            aparams &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            output          rtmp:&#x2F;&#x2F;127.0.0.1:[port]&#x2F;[app]?vhost&#x3D;[vhost]&#x2F;[stream]_[engine];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到上面配置中，增加设置<code>maxrate</code>，<code>minrate</code>，<code>bufsize</code>来配合控制视频的码率。</p>
<p><img src="/images/media/FFmpeg/bitrate-2.png" alt="image" title="增加设置`maxrate`，`minrate`，`bufsize`来配合控制视频的码率"></p>
<p>实际效果并不能固定码率，码率仍然在上下波动，但很明显能达到更小的波动范围。</p>
<hr>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/live/" rel="tag"># live</a>
              <a href="/tags/srs/" rel="tag"># srs</a>
              <a href="/tags/ffmpeg/" rel="tag"># ffmpeg</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2019/10/29/2019-10-29-srs_ffmpeg_transcode_as_needed/" rel="prev" title="srs中ffmpeg的按需转码实现方法">
      <i class="fa fa-chevron-left"></i> srs中ffmpeg的按需转码实现方法
    </a></div>
      <div class="post-nav-item">
    <a href="/2019/10/29/2019-10-29-srs_bench-v1/" rel="next" title="srs的推拉流压测">
      srs的推拉流压测 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#srs-%E6%89%80%E6%9C%89%E8%BD%AC%E7%A0%81%E5%8F%82%E6%95%B0%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.</span> <span class="nav-text">srs 所有转码参数介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-number">1.1.</span> <span class="nav-text">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
listen              1935;
vhost __defaultVhost__ &amp;#123;
    # the streaming transcode configs.
    transcode &amp;#123;
        # whether the transcode enabled.
        # if off, donot transcode.
        # default: off.
        enabled     on;
        # the ffmpeg 
        ffmpeg      .&#x2F;objs&#x2F;ffmpeg&#x2F;bin&#x2F;ffmpeg;
        # the transcode engine for matched stream.
        # all matched stream will transcoded to the following stream.
        # the transcode set name(ie. hd) is optional and not used.
        engine example &amp;#123;
            # whether the engine is enabled
            # default: off.
            enabled         on;
            # input format, can be:
            # off, do not specifies the format, ffmpeg will guess it.
            # flv, for flv or RTMP stream.
            # other format, for example, mp4&#x2F;aac whatever.
            # default: flv
            iformat         flv;
            # ffmpeg filters, follows the main input.
            vfilter &amp;#123;
                # the logo input file.
                i               .&#x2F;doc&#x2F;ffmpeg-logo.png;
                # the ffmpeg complex filter.
                # for filters, @see: http:&#x2F;&#x2F;ffmpeg.org&#x2F;ffmpeg-filters.html
                filter_complex  &#39;overlay&#x3D;10:10&#39;;
            &amp;#125;
            # video encoder name. can be:
            #       libx264: use h.264(libx264) video encoder.
            #       copy: donot encoder the video stream, copy it.
            #       vn: disable video output.
            vcodec          libx264;
            # video bitrate, in kbps
            # @remark 0 to use source video bitrate.
            # default: 0
            vbitrate        1500;
            # video framerate.
            # @remark 0 to use source video fps.
            # default: 0
            vfps            25;
            # video width, must be even numbers.
            # @remark 0 to use source video width.
            # default: 0
            vwidth          768;
            # video height, must be even numbers.
            # @remark 0 to use source video height.
            # default: 0
            vheight         320;
            # the max threads for ffmpeg to used.
            # default: 1
            vthreads        12;
            # x264 profile, @see x264 -help, can be:
            # high,main,baseline
            vprofile        main;
            # x264 preset, @see x264 -help, can be: 
            #       ultrafast,superfast,veryfast,faster,fast
            #       medium,slow,slower,veryslow,placebo
            vpreset         medium;
            # other x264 or ffmpeg video params
            vparams &amp;#123;
                # ffmpeg options, @see: http:&#x2F;&#x2F;ffmpeg.org&#x2F;ffmpeg.html
                t               100;
                # 264 params, @see: http:&#x2F;&#x2F;ffmpeg.org&#x2F;ffmpeg-codecs.html#libx264
                coder           1;
                b_strategy      2;
                bf              3;
                refs            10;
            &amp;#125;
            # audio encoder name. can be:
            #       libfdk_aac: use aac(libfdk_aac) audio encoder.
            #       copy: donot encoder the audio stream, copy it.
            #       an: disable audio output.
            acodec          libfdk_aac;
            # audio bitrate, in kbps. [16, 72] for libfdk_aac.
            # @remark 0 to use source audio bitrate.
            # default: 0
            abitrate        70;
            # audio sample rate. for flv&#x2F;rtmp, it must be:
            #       44100,22050,11025,5512
            # @remark 0 to use source audio sample rate.
            # default: 0
            asample_rate    44100;
            # audio channel, 1 for mono, 2 for stereo.
            # @remark 0 to use source audio channels.
            # default: 0
            achannels       2;
            # other ffmpeg audio params
            aparams &amp;#123;
                # audio params, @see: http:&#x2F;&#x2F;ffmpeg.org&#x2F;ffmpeg-codecs.html#Audio-Encoders
                # @remark SRS supported aac profile for HLS is: aac_low, aac_he, aac_he_v2
                profile:a   aac_low;
                bsf:a       aac_adtstoasc;
            &amp;#125;
            # output format, can be:
            #       off, do not specifies the format, ffmpeg will guess it.
            #       flv, for flv or RTMP stream.
            #       other format, for example, mp4&#x2F;aac whatever.
            # default: flv
            oformat         flv;
            # output stream. variables:
            #       [vhost] the input stream vhost.
            #       [port] the intput stream port.
            #       [app] the input stream app.
            #       [stream] the input stream name.
            #       [engine] the tanscode engine name.
            output          rtmp:&#x2F;&#x2F;127.0.0.1:[port]&#x2F;[app]?vhost&#x3D;[vhost]&#x2F;[stream]_[engine];
        &amp;#125;
    &amp;#125;
&amp;#125;
</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%BD%AC%E7%A0%81engine%E9%85%8D%E7%BD%AE"><span class="nav-number">2.</span> <span class="nav-text">转码engine配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#-1"><span class="nav-number">2.1.</span> <span class="nav-text">1
2
3
4
5
6
7
8
9
10
11
12
13
vhost www.test.com &amp;#123;
    transcode &amp;#123;
        engine 360p &amp;#123;
            ...
        &amp;#125;
        engine 480p &amp;#123;
            ...
        &amp;#125;
        engine 720p &amp;#123;
            ...
        &amp;#125;
    &amp;#125;
&amp;#125;
</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#srs-%E4%B8%AD%E5%8F%AF%E4%BD%BF%E7%94%A8%E7%9A%84%E8%BD%AC%E7%A0%81%E5%8F%82%E6%95%B0"><span class="nav-number">3.</span> <span class="nav-text">srs 中可使用的转码参数</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B4%E4%BD%93%E5%8F%82%E6%95%B0"><span class="nav-number">3.1.</span> <span class="nav-text">整体参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#-2"><span class="nav-number">3.2.</span> <span class="nav-text">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
# 输入格式，其中flv表示输入格式为flv或者是RTMP。
iformat         flv;

# ffmpeg 滤镜
vfilter &amp;#123;
&amp;#125;

# 视频相关参数
vcodec          libx264;
vbitrate        1500;
vfps            25;
vwidth          768;
vheight         320;
vthreads        12;
vprofile        main;
vpreset         medium;
vparams &amp;#123;
    t               100;
    coder           1;
    b_strategy      2;
    bf              3;
    refs            10;
&amp;#125;

# 音频相关参数
acodec          libfdk_aac;
abitrate        70;
asample_rate    44100;
achannels       2;
aparams &amp;#123;
    profile:a   aac_low;
    bsf:a       aac_adtstoasc;
&amp;#125;

# 输出格式，其中flv表示输出格式为flv或者是RTMP。
oformat         flv;

# 转码后的输出流
output          rtmp:&#x2F;&#x2F;127.0.0.1:[port]&#x2F;[app]?vhost&#x3D;[vhost]&#x2F;[stream]_[engine];
</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%86%E9%A2%91%E7%9B%B8%E5%85%B3%E5%8F%82%E6%95%B0"><span class="nav-number">3.3.</span> <span class="nav-text">视频相关参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%86%E9%A2%91%E6%BB%A4%E9%95%9C-vfilter"><span class="nav-number">3.4.</span> <span class="nav-text">视频滤镜 vfilter</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9F%B3%E9%A2%91%E7%9B%B8%E5%85%B3%E5%8F%82%E6%95%B0"><span class="nav-number">3.5.</span> <span class="nav-text">音频相关参数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%BD%AC%E7%A0%81%E9%85%8D%E7%BD%AE%E4%B8%BE%E4%BE%8B"><span class="nav-number">4.</span> <span class="nav-text">转码配置举例</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%94%B9%E5%8F%98%E8%A7%86%E9%A2%91%E5%88%86%E8%BE%A8%E7%8E%87"><span class="nav-number">4.1.</span> <span class="nav-text">改变视频分辨率</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#-3"><span class="nav-number">4.2.</span> <span class="nav-text">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
vhost www.transcode.com &amp;#123;
    transcode &amp;#123;
        enabled      on;
        ffmpeg      .&#x2F;objs&#x2F;ffmpeg&#x2F;bin&#x2F;ffmpeg;
        engine 720_60  &amp;#123;
            enabled         on;
            vfilter &amp;#123;
                filter_complex  &#39;scale&#x3D;1280:-1&#39;;
            &amp;#125;
            vcodec          libx264;
            vbitrate        3500;
            vfps            60;
            vwidth          0;
            vheight         0;
            vthreads        12;
            vprofile        main;
            vpreset         fast;
            vparams &amp;#123;
            &amp;#125;
            acodec          libfdk_aac;
            abitrate        50;
            asample_rate    44100;
            achannels       2;
            aparams &amp;#123;
            &amp;#125;
            output          rtmp:&#x2F;&#x2F;192.168.90.229:2019&#x2F;persist?vhost&#x3D;lrm.test.com&#x2F;long_720_60;
        &amp;#125;
    &amp;#125;
&amp;#125;
</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E6%B0%B4%E5%8D%B0"><span class="nav-number">4.3.</span> <span class="nav-text">添加水印</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CBR%E6%81%92%E5%AE%9A%E7%BC%96%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="nav-number">4.4.</span> <span class="nav-text">CBR恒定编码实现</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="龙"
      src="/images/head/head_bigfan.png">
  <p class="site-author-name" itemprop="name">龙</p>
  <div class="site-description" itemprop="description">哇咔咔</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">92</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2017 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">龙</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

  

</body>
</html>
